!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("wafer-action",[],e):"object"==typeof exports?exports["wafer-action"]=e():(t.wafer=t.wafer||{},t.wafer.wafers=t.wafer.wafers||{},t.wafer.wafers["wafer-action"]=e())}("undefined"!=typeof self?self:this,function(){return function(t){function e(a){if(r[a])return r[a].exports;var i=r[a]={i:a,l:!1,exports:{}};return t[a].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var r={};return e.m=t,e.c=r,e.d=function(t,r,a){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:a})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="https://s.yimg.com/aaq/wf/",e(e.s="./src/entry.js")}({"./src/base.js":function(t,e,r){"use strict";function a(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},c=function(){function t(t,e){var r=[],a=!0,i=!1,o=void 0;try{for(var n,s=t[Symbol.iterator]();!(a=(n=s.next()).done)&&(r.push(n.value),!e||r.length!==e);a=!0);}catch(t){i=!0,o=t}finally{try{!a&&s.return&&s.return()}finally{if(i)throw o}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=function(){function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}(),l=[],f=window.wafer,p=f.base,d=f.constants,m=f.utils,b=f.WaferBaseClass,y=d.ATTR_PREFIX,h=m.bindEvent,v=m.fetchWithCache,g=m.findAncestor,_=m.getTemplateContent,w=m.getWaferInstanceForElem,E=["handleClick"],k="wafer-action-is-true",T={},A={SHOW_MORE:"SHOW_LESS",SHOW_LESS:"SHOW_MORE"},O=function(t){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r.appId,n=r.actionHost,u=r.bookmarkActionHost,f=r.crumb,p=r.id,d=r.name,m=r.providerBrandProperty,b=r.selector,h=r.subType,v=r.type;i(this,e);var w=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,{selector:b},{STATE_ATTRS:l}));a=t.getAttribute(y+"app-id")||a,f=t.getAttribute(y+"crumb")||f;var T=t.getAttribute(y+"action-type")||v||"follow",A=t.getAttribute(y+"action-api-path"),O=t.getAttribute(y+"action-sub-type")||h,S=t.getAttribute(y+"action-sub-type-category")||"",I=t.getAttribute(y+"action-id")||p,P=t.getAttribute(y+"action-label"),L=t.getAttribute(y+"action-ylk"),j=t.getAttribute(y+"action-name")||d,C=P&&P.split("|")||[],R=c(C,2),H=R[0],B=R[1],x=L&&L.split("|")||[],M=c(x,2),F=M[0],W=M[1],N=t.getAttribute(y+"action-title")||"",D=t.getAttribute(y+"action-boundary"),U=t.getAttribute(y+"action-on-template"),Y=t.getAttribute(y+"action-off-template"),q=t.getAttribute(y+"action-error-template"),G=t.getAttribute(y+"action-template-target"),X=Number(t.getAttribute(y+"action-template-animation-duration")),J=t.getAttribute("data-ylk"),z=U&&_(document.getElementById(U)),V=Y&&_(document.getElementById(Y)),K=q&&_(document.getElementById(q)),Q=G&&document.getElementById(G),Z={follow:n+"api/v3/topics?appId="+a,reactions:n+"api/user/v1/declared/reactions/CONTENT/PREFERENCE?appId="+a},$=A||Z[T]||Z[O],tt=D&&g(t,D);return w._util=s({},w._util,{actionErrorTemplate:K,actionHost:n,actionOffTemplate:V,actionOnTemplate:z,actionTemplateDuration:X,apiPath:$,appId:a,bookmarkActionHost:u,boundaryElem:tt,crumb:f,elem:t,falseLabel:B,falseYlk:W,id:I,mappingId:I+T+O+S,name:j,providerBrandProperty:m,subType:O,subTypeCategory:S,templateTargetElem:Q,title:N,trueLabel:H,trueYlk:F,type:T,ylk:J}),E.forEach(function(t){w[t]=w[t].bind(w)}),w._state={actionStatus:!1,inProgress:!1},"reactions"===O&&(w._util.isReaction=!0,w._state.isReactionFetched=!1),t.classList.add("has-action-click","has-wafer-click"),setTimeout(function(){w.setActionStatus(t.classList.contains(k))},0),w}return n(e,t),u(e,[{key:"renderActionTemplate",value:function(t){var e=t.type,r=void 0;if(this.updateAriaLiveRegion({type:e}),"error"===e){r=this._util.actionErrorTemplate}else if(this._state.actionStatus){var a=this._util.actionOnTemplate;r=a}else{var i=this._util.actionOffTemplate;r=i}if(r){var o=this._util,n=o.actionTemplateDuration,s=o.templateTargetElem,c=document.createElement("div");c.innerHTML=r;var u=c.children[0],l=u.getElementsByClassName("close")[0];s&&(s.innerHTML=""),(s||document.body).appendChild(u),l&&h(u,"click",function(t){t.preventDefault(),u.classList.add("animation-disappear-start"),setTimeout(function(){u.classList.add("animation-disappear-end"),u.parentNode.removeChild(u)},n)},{passive:!1}),n&&(u.classList.add("animation-appear-start"),setTimeout(function(){u.classList.add("animation-appear-end")},n))}}},{key:"statusDidUpdate",value:function(t){var e=this._util.elem;if(e){var r=this._util,a=r.falseLabel,i=r.falseYlk,o=r.trueLabel,n=r.trueYlk,s=r.ylk;this._state.actionStatus=t,t?(i&&e.setAttribute("data-ylk",s+";"+n),a&&e.setAttribute("title",a),e.classList.add(k)):(n&&e.setAttribute("data-ylk",s+";"+i),o&&e.setAttribute("title",o),e.classList.remove(k))}}},{key:"triggerTopicAction",value:function(t){var e=this._util,r=e.appId,i=e.actionHost,o=e.bookmarkActionHost,n=e.id,s=e.subType,c=e.subTypeCategory,u=e.title,l=e.type,f=this._util.apiPath,p={bookmark:this._state.actionStatus?"POST":"DELETE",follow:this._state.actionStatus?"PUT":"DELETE",reactions:"POST",urlBookmark:"DELETE"},d=p[l]||p[s],m=void 0,b=void 0;if("follow"===l)m={types:a({},s,[{id:n}])},b={Crumb:t},"provider"===s&&(m.types[s][0].type=c||"PROVIDER");else if("reactions"===s){var y=this._state.actionStatus?"add":"remove";if(m=a({},y,[{itemId:n,reactions:[l]}]),"add"===y){var h=A[l];this.setOppositeActionStatus(!1,this._util.mappingId.replace(l,h)),h&&(m.remove=[{itemId:n,reactions:[h]}])}b={"X-CSRF-Token":t}}else"bookmark"===l?("DELETE"===d?f=o+"api/v1/user/bookmarks/"+s+"/"+n+"?appId="+r:(f=o+"api/v1/user/bookmarks/"+s+"?appId="+r,m={contentId:n,title:u}),b={"X-CSRF-Token":t}):"urlBookmark"===l?(f="deleteFolder"===s?i+"api/v1/bookmarks/folders/"+n+"?appId="+r:i+"api/v1/bookmarks/items/"+n+"?appId="+r,b={Crumb:t}):"location"===l&&(m={requests:{g0:{resource:"WeatherLocationService.favoriteLocation",operation:this._state.actionStatus?"create":"delete",params:{woeid:n}}}});return v(f,{body:JSON.stringify(m),cache:0,clientHeaders:b,credentials:"include",method:d,mode:"cors"})}},{key:"getCrumb",value:function(){var t=this._util,e=t.actionHost,r=t.appId,a=t.bookmarkActionHost,i=t.subType,o=t.type;if("location"===o)return Promise.resolve({});var n=this._util.crumb||T[o];if(n)return new Promise(function(t){t(n||"")});var s=void 0;return s="bookmark"===o?a+"api/v1/auth/crumb?appId="+r:"reactions"===i?e+"api/auth/v2/crumb?appId="+r:e+"api/v1/auth/crumb?appId="+r,v(s,{cache:0,credentials:"include",mode:"cors"}).then(function(t){var e=t.crumb;if(T[o]=e,!e)throw new Error("crumb not found");return e})}},{key:"trigger",value:function(t){var e=this,r=this._util.type;if(t){var a=t.crumb;a&&(T[r]=a),this._util=s({},this._util,t)}var i=this._util,o=i.elem,n=i.boundaryElem,c=i.name,u=this._state.actionStatus;this._state.inProgress=!0,n&&n.classList.add("wafer-action-in-progress"),u?this.setActionStatus(!1):this.setActionStatus(!0),this.getCrumb().then(function(t){return e.triggerTopicAction(t)}).then(function(t){var r=t||{},a=r.result,i=void 0===a?{}:a,s=i.success,u=void 0===s?{}:s,l=u.entities,f=void 0===l?[]:l,d=e._util,m=d.id,b=d.subType,h=d.type,v={id:m,name:c,subType:b,type:h},g="follow"===h&&f.some(function(t){return t.id===m}),_=null!==t&&t===Object(t),E="reactions"===b,k=!!E&&_,T="bookmark"===h&&_,A="urlBookmark"===h&&_,O=void 0;if("follow"===h)O=g;else if(E)O=k;else if("urlBookmark"===h)O=A;else if("location"===h){var S=e._util.locationAssistTargetElem;if(!S){var I=o.getAttribute(y+"action-location-assist-target");I&&(S=e._util.locationAssistTargetElem=document.querySelector(I))}if(S){var P=w(S,"wafer-autocomplete");P&&P.instance._instance.fetchAndRenderSavedLocations()}O=!0}else O=T;if(!O)throw n&&(n.classList.add("wafer-action-boundary-error"),n.classList.remove("wafer-action-boundary-success","wafer-action-in-progress")),new Error("action failed");n&&(n.classList.add("wafer-action-boundary-success"),n.classList.remove("wafer-action-boundary-error","wafer-action-in-progress")),e.renderActionTemplate({type:"success"}),e._state.inProgress=!1,e.didComplete(null,v),p.emitWaferEvent("action:success",{elem:o,meta:{}})}).catch(function(){e._state.inProgress=!1,n&&(n.classList.remove("wafer-action-in-progress","wafer-action-boundary-success"),n.classList.add("wafer-action-boundary-error")),e._state.actionStatus=!e._state.actionStatus,e.renderActionTemplate({type:"error"}),p.emitWaferEvent("action:failed",{elem:o,meta:{}}),e.setActionStatus(e._state.actionStatus)})}},{key:"handleClick",value:function(t){t.preventDefault(),this._state.inProgress||this.trigger()}}]),e}(b);O.events={click:[["has-action-click","handleClick"]]},e.default=O,t.exports=e.default},"./src/controller.js":function(t,e,r){"use strict";function a(){return c=i(r("./src/base.js"))}function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var c,u=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},l=function(){function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}(),f=window.wafer,p=f.base,d=f.controllers,m=f.utils,b=d.WaferBaseController,y=m.fetchWithCache,h=m.getConfigFromJSONScriptNode,v=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.root,i=void 0===r?document:r,s=t.selector;o(this,e);var l=h(document.getElementById("wafer-action-config")),f=l.actionHost,d=l.appId,m=l.bookmarkActionHost,b=l.crumb,y=l.providerBrandProperty,v=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,{root:i,selector:s,props:{actionHost:f,appId:d,bookmarkActionHost:m,crumb:b,providerBrandProperty:y,selector:s},WaferClass:(c||a()).default})),g=v;return v.sync(),v._state=u({},v._state,{idInstanceMapping:new Map}),(c||a()).default.prototype.setActionStatus=function(t){var e=this._util.mappingId,r=g._state.idInstanceMapping;r.has(e)||r.set(e,[]),r.get(e).push(this),r.get(e).forEach(function(e){e.statusDidUpdate(t)})},(c||a()).default.prototype.setOppositeActionStatus=function(t,e){var r=g._state.idInstanceMapping;r.has(e)||r.set(e,[]),r.get(e).forEach(function(e){e.statusDidUpdate(t)})},(c||a()).default.prototype.updateAriaLiveRegion=function(t){var e=t.type,r=this._state.actionStatus,a=this._util.type,i="success"===e?r?"True":"False":"Error",o=l[""+a+i+"Message"];o&&(p.liveAriaRegion.innerHTML=o)},v}return s(e,t),l(e,[{key:"reactionsFetch",value:function(){if(!window.wafer.base.isBot){var t=this._state.elementInstances,e={},r=[],a={},i=void 0,o=0,n=0,s=!0,c=!1,u=void 0;try{for(var l,f=t.values()[Symbol.iterator]();!(s=(l=f.next()).done);s=!0){var d=l.value,m=d.instance,b=m._util.isReaction,h=m._state.isReactionFetched;if(b&&!h){m._state.isReactionFetched=!0;var v=m._util,g=v.appId,_=v.actionHost,w=v.elem,E=v.id,k=v.type;if(r[o]=r[o]||[],i=i||_+"api/user/v1/declared/reactions/CONTENT?appId="+g+"&reactionGroups=PREFERENCE",b&&E){var T=e[E],A=E+k;!T&&r[o].push(E),a[A]=a[A]||[],a[A]=w,!T&&++n>=8&&(n=0,o++)}}}}catch(t){c=!0,u=t}finally{try{!s&&f.return&&f.return()}finally{if(c)throw u}}return Promise.all(r.map(function(e){var r={},o=[];if(e.forEach(function(t){r[t]||(o.push(t),r[t]=!0)}),o.length)return y(i+"&itemIds="+o.join(","),{cache:0,clientHeaders:{},credentials:"include",method:"GET",mode:"cors"}).then(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.userReactions;(void 0===r?[]:r).forEach(function(e){var r=e.itemId,i=e.reactionList;(void 0===i?[]:i).some(function(e){return"PREFERENCE"===e.reactionGroup&&(e.reactions.forEach(function(e){var i=a[r+e];if(i){i.classList.add("wafer-reaction-fetched");var o=t.get(i).instance;o&&o.setActionStatus(!0)}}),!0)})})})})).catch(function(){p.emitWaferEvent("action:reactions:fetch:failed",{meta:{url:i}})})}}},{key:"didSync",value:function(){var t=this,e=this._state,r=e.elementInstances,a=e.mounted;0===r.size||a||(this._state.mounted=!0),setTimeout(function(){t.reactionsFetch()},10)}}]),e}(b);e.default=v,t.exports=e.default},"./src/entry.js":function(t,e,r){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i;e.default=new((i||function(){return i=a(r("./src/controller.js"))}()).default)({selector:".wafer-action"}),t.exports=e.default}})});